webpackJsonp([77],{2095:function(n,e,l){"use strict";function View_AddonStorageManagerCoursesStoragePage_2(n){return t._58(0,[(n()(),t._32(0,0,null,null,1,"span",[],null,null,null,null,null)),(n()(),t._56(1,null,["",""]))],null,function(n,e){n(e,1,0,e.parent.context.$implicit.displayname)})}function View_AddonStorageManagerCoursesStoragePage_3(n){return t._58(0,[(n()(),t._32(0,0,null,null,1,"span",[],null,null,null,null,null)),(n()(),t._56(1,null,["",""]))],null,function(n,e){n(e,1,0,e.parent.context.$implicit.fullname)})}function View_AddonStorageManagerCoursesStoragePage_4(n){return t._58(0,[(n()(),t._32(0,0,null,null,2,"h3",[],null,null,null,null,null)),(n()(),t._56(1,null,["",""])),t._48(131072,E.a,[N.a,t.j])],null,function(n,e){n(e,1,0,t._57(e,1,0,t._45(e,2).transform("core.downloading")))})}function View_AddonStorageManagerCoursesStoragePage_1(n){return t._58(0,[(n()(),t._32(0,0,null,null,34,"ion-item",[["class","course item item-block"]],null,null,null,U.b,U.a)),t._31(1,1097728,null,3,$.a,[F.a,G.a,t.t,t.W,[2,T.a]],null,null),t._53(335544320,4,{contentLabel:0}),t._53(603979776,5,{_buttons:1}),t._53(603979776,6,{_icons:1}),t._31(5,16384,null,0,H.a,[],null,null),(n()(),t._56(-1,2,["\n                    "])),(n()(),t._32(7,0,null,2,7,"h2",[["text-wrap",""]],null,null,null,null,null)),(n()(),t._56(-1,null,["\n                        "])),(n()(),t._27(16777216,null,null,1,null,View_AddonStorageManagerCoursesStoragePage_2)),t._31(10,16384,null,0,J.k,[t._12,t._7],{ngIf:[0,"ngIf"]},null),(n()(),t._56(-1,null,["\n                        "])),(n()(),t._27(16777216,null,null,1,null,View_AddonStorageManagerCoursesStoragePage_3)),t._31(13,16384,null,0,J.k,[t._12,t._7],{ngIf:[0,"ngIf"]},null),(n()(),t._56(-1,null,["\n                    "])),(n()(),t._56(-1,2,["\n                    "])),(n()(),t._27(16777216,null,2,1,null,View_AddonStorageManagerCoursesStoragePage_4)),t._31(17,16384,null,0,J.k,[t._12,t._7],{ngIf:[0,"ngIf"]},null),(n()(),t._56(-1,2,["\n                    "])),(n()(),t._32(19,0,null,2,5,"p",[],null,null,null,null,null)),(n()(),t._56(-1,null,["\n                        "])),(n()(),t._32(21,0,null,null,1,"ion-icon",[["item-start",""],["name","cube"],["role","img"]],[[2,"hide",null]],null,null,null,null)),t._31(22,147456,[[6,4]],0,q.a,[G.a,t.t,t.W],{name:[0,"name"]},null),(n()(),t._56(23,null,["\n                        ","\n                    "])),t._50(24,1),(n()(),t._56(-1,2,["\n                    "])),(n()(),t._32(26,0,null,4,7,"button",[["icon-only",""],["ion-button",""],["item-end",""]],[[8,"disabled",0]],[[null,"click"]],function(n,e,l){var t=!0;if("click"===e){t=!1!==n.component.deleteCourse(n.context.$implicit)&&t}return t},B.b,B.a)),t._31(27,1097728,[[5,4]],0,K.a,[[8,""],G.a,t.t,t.W],null,null),(n()(),t._56(-1,0,["\n                        "])),(n()(),t._32(29,0,null,0,3,"core-icon",[["name","trash"]],null,null,null,Q.b,Q.a)),t._31(30,704512,null,0,X.a,[t.t,G.a],{name:[0,"name"],ariaLabel:[1,"ariaLabel"]},null),t._49(31,{name:0}),t._48(131072,E.a,[N.a,t.j]),(n()(),t._56(-1,0,["\n                    "])),(n()(),t._56(-1,2,["\n                "]))],function(n,e){n(e,10,0,e.context.$implicit.displayname);n(e,13,0,!e.context.$implicit.displayname);n(e,17,0,e.context.$implicit.isDownloading);n(e,22,0,"cube");n(e,30,0,"trash",t._35(1,"",t._57(e,30,1,t._45(e,32).transform("addon.storagemanager.deletedatafrom",n(e,31,0,e.context.$implicit.name))),""))},function(n,e){n(e,21,0,t._45(e,22)._hidden);n(e,23,0,t._57(e,23,0,n(e,24,0,t._45(e.parent,0),e.context.$implicit.totalSize)));n(e,26,0,e.context.$implicit.isDownloading)})}function View_AddonStorageManagerCoursesStoragePage_0(n){return t._58(0,[t._48(0,Y.a,[Z.b,nn.b]),(n()(),t._32(1,0,null,null,12,"ion-header",[],null,null,null,null,null)),t._31(2,16384,null,0,en.a,[G.a,t.t,t.W,[2,ln.a]],null,null),(n()(),t._56(-1,null,["\n    "])),(n()(),t._32(4,0,null,null,8,"ion-navbar",[["class","toolbar"],["core-back-button",""]],[[8,"hidden",0],[2,"statusbar-padding",null]],null,null,tn.b,tn.a)),t._31(5,49152,null,0,an.a,[on.a,[2,ln.a],[2,un.a],G.a,t.t,t.W],null,null),t._31(6,212992,null,0,rn.a,[an.a,N.a,p.b],null,null),(n()(),t._56(-1,3,["\n        "])),(n()(),t._32(8,0,null,3,3,"ion-title",[],null,null,null,sn.b,sn.a)),t._31(9,49152,null,0,cn.a,[G.a,t.t,t.W,[2,dn.a],[2,an.a]],null,null),(n()(),t._56(10,0,["",""])),t._48(131072,E.a,[N.a,t.j]),(n()(),t._56(-1,3,["\n    "])),(n()(),t._56(-1,null,["\n"])),(n()(),t._56(-1,null,["\n"])),(n()(),t._32(15,0,null,null,63,"ion-content",[],[[2,"statusbar-padding",null],[2,"has-refresher",null]],null,null,_n.b,_n.a)),t._31(16,4374528,null,0,gn.a,[G.a,fn.a,hn.a,t.t,t.W,on.a,pn.a,t.N,[2,ln.a],[2,un.a]],null,null),(n()(),t._56(-1,1,["\n    "])),(n()(),t._32(18,0,null,1,59,"core-loading",[],null,null,null,bn.b,bn.a)),t._31(19,638976,null,0,mn.a,[N.a,t.t,p.b,wn.b],{hideUntil:[0,"hideUntil"]},null),(n()(),t._56(-1,0,["\n        "])),(n()(),t._32(21,0,null,0,44,"ion-card",[],null,null,null,null,null)),t._31(22,16384,null,0,Sn.a,[G.a,t.t,t.W],null,null),(n()(),t._56(-1,null,["\n            "])),(n()(),t._32(24,0,null,null,40,"ion-card-header",[],null,null,null,null,null)),t._31(25,16384,null,0,Cn.a,[G.a,t.t,t.W],null,null),(n()(),t._56(-1,null,["\n                "])),(n()(),t._32(27,0,null,null,2,"h1",[["text-wrap",""]],null,null,null,null,null)),(n()(),t._56(28,null,["",""])),t._48(131072,E.a,[N.a,t.j]),(n()(),t._56(-1,null,["\n                "])),(n()(),t._32(31,0,null,null,2,"p",[["text-wrap",""]],null,null,null,null,null)),(n()(),t._56(32,null,["",""])),t._48(131072,E.a,[N.a,t.j]),(n()(),t._56(-1,null,["\n                "])),(n()(),t._32(35,0,null,null,28,"ion-item",[["class","size item item-block"],["no-padding",""],["padding-top",""],["text-wrap",""]],null,null,null,U.b,U.a)),t._31(36,1097728,null,3,$.a,[F.a,G.a,t.t,t.W,[2,T.a]],null,null),t._53(335544320,1,{contentLabel:0}),t._53(603979776,2,{_buttons:1}),t._53(603979776,3,{_icons:1}),t._31(40,16384,null,0,H.a,[],null,null),(n()(),t._56(-1,2,["\n                    "])),(n()(),t._32(42,0,null,0,1,"ion-icon",[["item-start",""],["name","cube"],["role","img"]],[[2,"hide",null]],null,null,null,null)),t._31(43,147456,[[3,4]],0,q.a,[G.a,t.t,t.W],{name:[0,"name"]},null),(n()(),t._56(-1,2,["\n                    "])),(n()(),t._32(45,0,null,2,2,"h2",[["text-wrap",""]],null,null,null,null,null)),(n()(),t._56(46,null,["",""])),t._48(131072,E.a,[N.a,t.j]),(n()(),t._56(-1,2,["\n                    "])),(n()(),t._32(49,0,null,4,5,"div",[["item-end",""]],null,null,null,null,null)),(n()(),t._56(-1,null,["\n                        "])),(n()(),t._32(51,0,null,null,2,"p",[["text-end",""]],null,null,null,null,null)),(n()(),t._56(52,null,["",""])),t._50(53,1),(n()(),t._56(-1,null,["\n                    "])),(n()(),t._56(-1,2,["\n                    "])),(n()(),t._32(56,0,null,4,6,"button",[["icon-only",""],["ion-button",""],["item-end",""],["no-padding",""]],[[8,"disabled",0]],[[null,"click"]],function(n,e,l){var t=!0;if("click"===e){t=!1!==n.component.deleteCompletelyDownloadedCourses()&&t}return t},B.b,B.a)),t._31(57,1097728,[[2,4]],0,K.a,[[8,""],G.a,t.t,t.W],null,null),(n()(),t._56(-1,0,["\n                        "])),(n()(),t._32(59,0,null,0,2,"core-icon",[["name","trash"]],null,null,null,Q.b,Q.a)),t._31(60,704512,null,0,X.a,[t.t,G.a],{name:[0,"name"],ariaLabel:[1,"ariaLabel"]},null),t._48(131072,E.a,[N.a,t.j]),(n()(),t._56(-1,0,["\n                    "])),(n()(),t._56(-1,2,["\n                "])),(n()(),t._56(-1,null,["\n            "])),(n()(),t._56(-1,null,["\n        "])),(n()(),t._56(-1,0,["\n        "])),(n()(),t._32(67,0,null,0,9,"ion-card",[],null,null,null,null,null)),t._31(68,16384,null,0,Sn.a,[G.a,t.t,t.W],null,null),(n()(),t._56(-1,null,["\n            "])),(n()(),t._32(70,0,null,null,5,"ion-list",[],null,null,null,null,null)),t._31(71,16384,null,0,vn.a,[G.a,t.t,t.W,fn.a,yn.l,hn.a],null,null),(n()(),t._56(-1,null,["\n                "])),(n()(),t._27(16777216,null,null,1,null,View_AddonStorageManagerCoursesStoragePage_1)),t._31(74,802816,null,0,J.j,[t._12,t._7,t.E],{ngForOf:[0,"ngForOf"]},null),(n()(),t._56(-1,null,["\n            "])),(n()(),t._56(-1,null,["\n        "])),(n()(),t._56(-1,0,["\n    "])),(n()(),t._56(-1,1,["\n"])),(n()(),t._56(-1,null,["\n"]))],function(n,e){var l=e.component;n(e,6,0);n(e,19,0,l.loaded);n(e,43,0,"cube");n(e,60,0,"trash",t._35(1,"",t._57(e,60,1,t._45(e,61).transform("addon.storagemanager.deletecourses")),""));n(e,74,0,l.downloadedCourses)},function(n,e){var l=e.component;n(e,4,0,t._45(e,5)._hidden,t._45(e,5)._sbPadding);n(e,10,0,t._57(e,10,0,t._45(e,11).transform("addon.storagemanager.managestorage")));n(e,15,0,t._45(e,16).statusbarPadding,t._45(e,16)._hasRefresher);n(e,28,0,t._57(e,28,0,t._45(e,29).transform("core.courses.courses")));n(e,32,0,t._57(e,32,0,t._45(e,33).transform("addon.storagemanager.info")));n(e,42,0,t._45(e,43)._hidden);n(e,46,0,t._57(e,46,0,t._45(e,47).transform("addon.storagemanager.storageused")));n(e,52,0,t._57(e,52,0,n(e,53,0,t._45(e,0),l.totalSize)));n(e,56,0,0===l.completelyDownloadedCourses.length)})}Object.defineProperty(e,"__esModule",{value:!0});var t=l(0),a=l(5),o=l(3),u=l(26),r=l(32),s=l(111),i=l(15),c=l(55),d=l(794),_=l(53),g=l(37),f=l(4),h=l(50),p=l(9),b=l(38),m=this&&this.__assign||Object.assign||function(n){for(var e,l=1,t=arguments.length;l<t;l++){e=arguments[l];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=e[a])}return n},w=this&&this.__decorate||function(n,e,l,t){var a,o=arguments.length,u=o<3?e:null===t?t=Object.getOwnPropertyDescriptor(e,l):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(n,e,l,t);else for(var r=n.length-1;r>=0;r--)(a=n[r])&&(u=(o<3?a(u):o>3?a(e,l,u):a(e,l))||u);return o>3&&u&&Object.defineProperty(e,l,u),u},S=this&&this.__awaiter||function(n,e,l,t){return new(l||(l=Promise))(function(a,o){function fulfilled(n){try{step(t.next(n))}catch(n){o(n)}}function rejected(n){try{step(t.throw(n))}catch(n){o(n)}}function step(n){n.done?a(n.value):new l(function(e){e(n.value)}).then(fulfilled,rejected)}step((t=t.apply(n,e||[])).next())})},C=this&&this.__generator||function(n,e){function verb(o){return function(r){return function step(o){if(l)throw new TypeError("Generator is already executing.");for(;u;)try{if(l=1,t&&(a=t[2&o[0]?"return":o[0]?"throw":"next"])&&!(a=a.call(t,o[1])).done)return a;switch(t=0,a&&(o=[0,a.value]),o[0]){case 0:case 1:a=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,t=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){u=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){u.label=o[1];break}if(6===o[0]&&u.label<a[1]){u.label=a[1],a=o;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(o);break}a[2]&&u.ops.pop(),u.trys.pop();continue}o=e.call(n,u)}catch(n){o=[6,n],t=0}finally{l=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,r])}}var l,t,a,o,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},v=function(){function AddonStorageManagerCoursesStoragePage(){this.userCourses=[],this.downloadedCourses=[],this.completelyDownloadedCourses=[],this.totalSize=0,this.loaded=!1}return AddonStorageManagerCoursesStoragePage.prototype.ionViewDidLoad=function(){return S(this,void 0,void 0,function(){var n,e,l,t=this;return C(this,function(a){switch(a.label){case 0:return n=this,[4,c.a.instance.getUserCourses()];case 1:return n.userCourses=a.sent(),this.courseStatusObserver=p.a.instance.on(p.b.COURSE_STATUS_CHANGED,function(n){return t.onCourseUpdated(n.courseId,n.status)}),[4,i.a.instance.getDownloadedCourseIds()];case 2:return e=a.sent(),[4,Promise.all(this.userCourses.filter(function(n){return-1!==e.indexOf(n.id)}).map(function(n){return t.getDownloadedCourse(n)}))];case 3:return l=a.sent(),this.setDownloadedCourses(l),this.loaded=!0,[2]}})})},AddonStorageManagerCoursesStoragePage.prototype.ngOnDestroy=function(){this.courseStatusObserver&&this.courseStatusObserver.off()},AddonStorageManagerCoursesStoragePage.prototype.deleteCompletelyDownloadedCourses=function(){return S(this,void 0,void 0,function(){var n,e,l,t;return C(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,f.a.instance.showDeleteConfirm("core.course.confirmdeletestoreddata")];case 1:return a.sent(),[3,3];case 2:if(!(n=a.sent()).coreCanceled)throw n;return[2];case 3:e=f.a.instance.showModalLoading(),l=this.completelyDownloadedCourses.map(function(n){return n.id}),a.label=4;case 4:return a.trys.push([4,6,7,8]),[4,Promise.all(l.map(function(n){return b.a.instance.deleteCourseFiles(n)}))];case 5:return a.sent(),this.setDownloadedCourses(this.downloadedCourses.filter(function(n){return!d.a.contains(l,n.id)})),[3,8];case 6:return t=a.sent(),f.a.instance.showErrorModalDefault(t,h.c.instance.instant("core.errordeletefile")),[3,8];case 7:return e.dismiss(),[7];case 8:return[2]}})})},AddonStorageManagerCoursesStoragePage.prototype.deleteCourse=function(n){return S(this,void 0,void 0,function(){var e,l,t;return C(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,f.a.instance.showDeleteConfirm("core.course.confirmdeletestoreddata")];case 1:return a.sent(),[3,3];case 2:if(!(e=a.sent()).coreCanceled)throw e;return[2];case 3:l=f.a.instance.showModalLoading(),a.label=4;case 4:return a.trys.push([4,6,7,8]),[4,b.a.instance.deleteCourseFiles(n.id)];case 5:return a.sent(),this.setDownloadedCourses(d.a.withoutItem(this.downloadedCourses,n)),[3,8];case 6:return t=a.sent(),f.a.instance.showErrorModalDefault(t,h.c.instance.instant("core.errordeletefile")),[3,8];case 7:return l.dismiss(),[7];case 8:return[2]}})})},AddonStorageManagerCoursesStoragePage.prototype.onCourseUpdated=function(n,e){return S(this,void 0,void 0,function(){var l,t;return C(this,function(a){switch(a.label){case 0:return n==i.b.ALL_COURSES_CLEARED?(this.setDownloadedCourses([]),[2]):(l=this.downloadedCourses.find(function(e){return e.id===n}))?(l.isDownloading=e===g.a.DOWNLOADING,t=l,[4,this.calculateDownloadedCourseSize(l.id)]):[2];case 1:return t.totalSize=a.sent(),this.setDownloadedCourses(this.downloadedCourses),[2]}})})},AddonStorageManagerCoursesStoragePage.prototype.setDownloadedCourses=function(n){this.downloadedCourses=n,this.completelyDownloadedCourses=n.filter(function(n){return!n.isDownloading}),this.totalSize=this.downloadedCourses.reduce(function(n,e){return n+e.totalSize},0)},AddonStorageManagerCoursesStoragePage.prototype.getDownloadedCourse=function(n){return S(this,void 0,void 0,function(){var e,l;return C(this,function(t){switch(t.label){case 0:return[4,this.calculateDownloadedCourseSize(n.id)];case 1:return e=t.sent(),[4,i.a.instance.getCourseStatus(n.id)];case 2:return l=t.sent(),[2,m({},n,{totalSize:e,isDownloading:l===g.a.DOWNLOADING})]}})})},AddonStorageManagerCoursesStoragePage.prototype.calculateDownloadedCourseSize=function(n){return S(this,void 0,void 0,function(){var e,l,t,a,o=this;return C(this,function(u){switch(u.label){case 0:return[4,i.a.instance.getSections(n)];case 1:return e=u.sent(),l=d.a.flatten(e.map(function(n){return n.modules})),t=l.map(function(e){return S(o,void 0,void 0,function(){var l;return C(this,function(t){switch(t.label){case 0:return[4,_.a.instance.getModuleStoredSize(e,n)];case 1:return l=t.sent(),[2,isNaN(l)?0:l]}})})}),[4,Promise.all(t)];case 2:return a=u.sent(),[2,a.reduce(function(n,e){return n+e},0)]}})})},AddonStorageManagerCoursesStoragePage=w([Object(t.m)({selector:"page-addon-storagemanager-courses-storage",templateUrl:"courses-storage.html"})],AddonStorageManagerCoursesStoragePage)}(),y=this&&this.__decorate||function(n,e,l,t){var a,o=arguments.length,u=o<3?e:null===t?t=Object.getOwnPropertyDescriptor(e,l):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(n,e,l,t);else for(var r=n.length-1;r>=0;r--)(a=n[r])&&(u=(o<3?a(u):o>3?a(e,l,u):a(e,l))||u);return o>3&&u&&Object.defineProperty(e,l,u),u},P=function(){function AddonStorageManagerCoursesStoragePageModule(){}return AddonStorageManagerCoursesStoragePageModule=y([Object(t.J)({declarations:[v],imports:[u.a,r.a,s.a,a.l.forChild(v),o.b.forChild()]})],AddonStorageManagerCoursesStoragePageModule)}(),D=l(1551),M=l(1552),A=l(1553),O=l(1554),x=l(1555),j=l(1556),W=l(1557),k=l(1558),L=l(1559),z=l(1560),V=l(1561),I=l(1562),R=l(1563),E=l(25),N=l(18),U=l(31),$=l(22),F=l(21),G=l(8),T=l(27),H=l(33),J=l(7),q=l(48),B=l(47),K=l(44),Q=l(85),X=l(78),Y=l(1584),Z=l(6),nn=l(10),en=l(379),ln=l(41),tn=l(739),an=l(216),on=l(35),un=l(20),rn=l(486),sn=l(740),cn=l(324),dn=l(252),_n=l(185),gn=l(28),fn=l(16),hn=l(34),pn=l(112),bn=l(57),mn=l(54),wn=l(2),Sn=l(79),Cn=l(327),vn=l(87),yn=l(45),Pn=t._30({encapsulation:2,styles:[],data:{}}),Dn=t._28("page-addon-storagemanager-courses-storage",v,function View_AddonStorageManagerCoursesStoragePage_Host_0(n){return t._58(0,[(n()(),t._32(0,0,null,null,1,"page-addon-storagemanager-courses-storage",[],null,null,null,View_AddonStorageManagerCoursesStoragePage_0,Pn)),t._31(1,180224,null,0,v,[],null,null)],null,null)},{},{},[]),Mn=l(23),An=l(375),On=l(376),xn=l(378),jn=l(377),Wn=l(485),kn=l(738),Ln=l(277);l.d(e,"AddonStorageManagerCoursesStoragePageModuleNgFactory",function(){return zn});var zn=t._29(P,[],function(n){return t._41([t._42(512,t.o,t._22,[[8,[D.a,M.a,A.a,O.a,x.a,j.a,W.a,k.a,L.a,z.a,V.a,I.a,R.a,Dn]],[3,t.o],t.L]),t._42(4608,J.m,J.l,[t.G,[2,J.w]]),t._42(4608,Mn.x,Mn.x,[]),t._42(4608,Mn.d,Mn.d,[]),t._42(4608,An.b,An.a,[]),t._42(4608,On.a,On.b,[]),t._42(4608,xn.b,xn.a,[]),t._42(4608,jn.b,jn.a,[]),t._42(4608,N.a,N.a,[Wn.a,An.b,On.a,xn.b,jn.b,N.b,N.c]),t._42(512,J.b,J.b,[]),t._42(512,Mn.v,Mn.v,[]),t._42(512,Mn.i,Mn.i,[]),t._42(512,Mn.s,Mn.s,[]),t._42(512,kn.a,kn.a,[]),t._42(512,o.b,o.b,[]),t._42(512,r.a,r.a,[]),t._42(512,s.a,s.a,[]),t._42(512,u.a,u.a,[]),t._42(512,kn.b,kn.b,[]),t._42(512,P,P,[]),t._42(256,N.c,void 0,[]),t._42(256,N.b,void 0,[]),t._42(256,Ln.a,v,[])])})}});